---
title: "SCED"
subtitle: "Vignette"
author: "Ian Hussey"
output:
  html_document:
    df_print: paged
    highlight: haddock
---

```{r include=FALSE}

knitr::opts_chunk$set(message = FALSE, 
                      warning = FALSE)

```

```{r}

# dependencies
library(SCED)
library(knitr)
library(tidyverse)

# dependencies required by SCED
library(broom)
library(coin)
library(survival)
library(effsize)
library(bootES)
library(boot)
library(stringr)
library(timesavers)  # from github/ianhussey

# disable scientific notation
options(scipen = 999) 

```

# Participant level analyses

Using built in dataset.

```{r}

results <- sced_analysis(data = simulated_data)

results %>%
  kable()

```

## Plot 

```{r fig.height=10, fig.width=5}

sced_plot(data = simulated_data)

```

# Meta analysis

You can optionally exclude participants from the meta analysis using the `baseline_trend_exclusion_criterion` parameter. You can change which effect size is meta analysed using the `effect_size` parameter.

```{r}

# meta analysis
meta_analysis <- sced_meta_analysis(results = results, effect_size = "ruscios_A")

# forest plot
forest_plot(meta_analysis, effect_size = "ruscios_A")

```

- `r meta_analysis$meta_effect`
- `r meta_analysis$meta_heterogeneity`

# Simulate SCED data

In order to learn to use the package without using the data you wish to ultimately analyse (which can be a source of unintentional p hacking), SCED data can easily be simulated using the `simulate_data` function. The number of participants, timepoints at A and B, and true effect size can be set to arbitrary values.

```{r}

# simulate data
data <- simulate_data(participants = 2,     # two participants
                      timepoints_a = 10,    # 10 timepoints pre 
                      timepoints_b = 10,    # 10 post intervention
                      cohens_d     = 2) %>% # Cohen's d = 2
  mutate(Participant = paste("Participant", Participant))

```